# contest 1022 (2025-6-27)

## [problem A](https://codeforces.com/contest/2108/problem/A)

### 题目简述

给定一个整数 $N$，考虑所有 $1$ 到 $N$ 的排列 $p$，定义函数
$$f(p) = \sum_{i=1}^{n} |p_i - i|$$
即每个位置与其数值之差的绝对值之和。
求所有排列中，$f(p)$ 可能取到的不同值有多少个。

其中 $1 \leq N \leq 500$。

### 思路

$f(p)$ 的最小值和最大值可以在排列正序和逆序时取到，前者易证明，后者证明如下：

不失一般性，我们考虑 $N > 3$ 的情况，我们对 1 到 $N$ 进行摆放，1 在摆放到位置 $N$ 时贡献最大，为 $N - 1$；
在考虑 2 时，同样是摆放到位置 $N$ 贡献最大，为 $N - 2$ 但是因为小于 $N$ 上摆放 1 时的贡献，所以只能选择次优，摆放至 $N - 1$的位置。
以此类推，可得到排列逆序时可取得最大值。

进而，我们将证明 $f(p)$ 的取值粒度为 2 且连续。

当我们考虑交换 $i$ 、$j$ 位置上的元素 $p_i$ 和 $p_j$ ，
可得到与 $i$ 、 $j$ 相关的贡献交换前为 $|p_i - i| + |p_j - j|$，交换后为 $|p_j - i| + |p_i - j|$，
因为多个元素之间的加减运算结果的奇偶性只取决于其中奇数元素的个数的奇偶性
(即如果其中奇数个数为奇数，那无论如何加减最终结果都为奇数，反之亦然)，
所以我们即使考虑了绝对值符号，交换前和交换后两个贡献值奇偶性都相同，即它们的差值为偶数，
意味着 $f(p)$ 的取值之间的差值均为偶数（粒度大于1）。

并且我们可以进行构造：正序排列开始构造，
通过将 1 与 2 到 $N$ 进行交换可以依次得到 $f(p) = 2, 4, \dots 2 \times (N - 1)$，
保持最后将 1 和 $N$ 交换位置的状态后将 2 与 3 到 $N - 1$ 进行交换，每次所得 $f(p)$ 同样以增 2 增长，
最后仍保持 2 与 $N - 1$ 交换后的位置，
对 3 和后续数进行处理，持续这个过程直到构造到逆序排列。

综上，我们证明了 $f(p)$ 的上下界，粒度以及取值的连续性。故最终的答案可以通过上界与下界的差值除以 2 再加 1 得到。

## [problem B](https://codeforces.com/contest/2108/problem/B)

### 题目简述

给定两个整数 $N$ 和 $X$，要求构造一个长度为 $N$ 的正整数数组 $a$，使得
$$a_1 \oplus a_2 \oplus \cdots \oplus a_N = X$$
在所有满足条件的数组中，找出元素和最小的一个，并输出其元素和。

其中 $1 \leq N, X \leq 10^9$。

### 思路

因为想让数组的异或值等于 $X$，所以 $X$ 的二进制位上为 1 的位置都应该在数组中找到至少一个元素在该位上为 1。
想要让数组的和最小，所以同一个二进制位上为 1 的元素要尽量少。
因此，我们考虑以下构造：

记录 $X$ 的二进制中 1 的个数为 $cnt$ ，当 $cnt \geq N$ 时，我们总是能选取一个或多个为 1 的位构成一个数组元素，
构造出的数组能保证每个为 1 的位在求和时只被加一次，答案即为 $X$ 本身。
当 $cnt \leq N$ 时，当利用每一个为 1 的位构造出一个元素后仍旧达不到要求的数组长度时，
我们需要考虑以元素和最小为目标构造剩余的元素。

当 $t = N - cnt$ 为偶数时，我们总是可以在二进制最低位填上成对的 1，
因为是偶数个 1， 所以将它们异或后会为 0 ，且最终的元素和应该为 $X + t$;
当 $t$ 为奇数时，$t - 1$ 为偶数，我们可以将 $t - 1$ 个元素根据偶数的方式构造。
最后一个元素，我们考虑先前填入的元素中是否存在最低位为 0 的元素（可证明，当 $X < 0$ 即存在至少一个元素满足条件），
如果存在则对最后一个元素和先前的元素的最低位都填上 1， 如果不存在，则在第二位上成对填上 1 （权重为 2）。
且答案分别为 $X + t + 1$ 和 $X + t + 3$。

## [problem D](https://codeforces.com/contest/2108/problem/D)

### 题目简述

Neo 面前有 $n$ 个按钮，权值为 $a_1, a_2, \dots, a_n$。他可以无限次创建克隆体，并让它们左右移动。

每当一个克隆体到达一个未按过的按钮，便会立即按下该按钮（按钮只能按一次）。
他需要按下所有按钮，且按下顺序对应的权值必须是非递增的。

Neo 最少需要创建多少个克隆体，才能完成任务。

其中 $1 \leq N \leq 2 \cdot 10^5$。

### 思路

我们先将数组去重，即使连续相同的元素只保留一个，因为连续相同的元素中只要有一个被处理其余的都可以依次被处理。

我们将大于其左右两边的元素（数组首尾只需要大于一边的元素）称作「极大值」，并且我么将证明本题答案即为极大值的数量。

* 必要性：每一个极大值前都需要创建一个克隆体，因为极大值大于其左右两边的元素，根据按下的顺序时非递增的要求，
极大值一定应该先于其左右两边的元素被按下，即克隆体不能通过按下左右两边的元素后移动到极大值，即为必要。
* 充分性：考虑每个极大值都已经被处理，考虑每一个元素，如果它的左右两边的元素均比其小，那其作为极大值已经被处理；
如果它左右两边存在比它大的元素，如果是极大值，那它一定可以通过这个极大值创建的克隆体的移动被处理；
如果它左右两边存在比它大又不是极大值的元素，此相邻元素如果已经被克隆体移动处理到，那当前元素也可以在后续被移动处理。
进而问题转化为此相邻的元素是否能被移动处理到，因为问题最后一定会转换为相邻存在极大值的情况，即这些元素可以被依次移动到达并处理。
综上，所有元素都可以被到达处理，所以充分。
